language: cpp

before_install:
 - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
 - sudo apt-get -qq update
 - sudo apt-get -qq install g++-4.9
 - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 90
 - sudo apt-get -qq install lib32stdc++6

script:
 - cmake .
 - make

env:
  global:
    secure: "EGPIwMAi/OJmmJyfJgEIaQLNEb4+HzsNcf1s0mSudSarAbwloc/5W29V+iQi4/GZUFky/IA/C/xdzlbeSsOuSxEkHu0QxYX2x5xXdbkD+jlX/YW5nUBDgGUGH3U2U5YowEuZLJdVRkDnalUFHOMsDHOGT+FfxX4RhcQ6B//ml2A="

after_success:
  - sudo apt-get -qq install lftp detox
  - ARCHIVE_NAME="`git show -s --format='%h - %s' | cut -c1-111`.tar.gz"
  - tar -czvf archive.tar.gz xorer
  - mv archive.tar.gz "$ARCHIVE_NAME"
  - ARCHIVE_NAME=`detox -v "$ARCHIVE_NAME" | sed 's/Scanning: //'`
  - lftp -c "open -u builds,$BUILD_PASSWORD sftp://archshift.com; put -O '/xorer/nightly/linux' '$ARCHIVE_NAME'"
